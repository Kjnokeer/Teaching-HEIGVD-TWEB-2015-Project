<div ng-controller="PollsCtrl">
   <div class='wrapper' >
      <div class='row'>
         <div class='col-lg-12'>
		 <form action="/user/polls" method="POST">
               <fieldset class='text-center'>
                  <legend>Add a poll</legend>
                  <div class='form-group'>
                     <input type="text" name="title" class="form-control" id="name" placeholder="Title" required>
                  </div>
                  <div class='form-group'>
                     <input type="text" name="state" class="form-control" id="state" placeholder="State (drafti, active, closed)" required>
                  </div>
                  <div class='form-group'>
                     <input type="text" name="access" class="form-control" id="access" placeholder="Access (public, private)" required>
                  </div>
                  <div class='text-center'>
                     <button type="submit" class="btn btn-primary btn-block">Create</button>
                  </div>
               </fieldset>
            </form>
			<br/><hr/><br/>
			  <legend class='text-center'>List of polls</legend>
            <table class='table'>
            <thead>
              <tr>
                <th>#</th>
                <th>Title</th>
                <th>Cr√©ation date</th>
				<th>Access</th>
                <th class='actions'>
                  Actions
                </th>
              </tr>
            </thead>
            <tbody>
				<tr ng-repeat="poll in polls">
				<td>{{poll._id}}</td>
                <td>{{poll.title}}</td>
                <td>{{poll.creationDate}}</td>
				<td>{{poll.access}}
                <td class='action'>
                  <a class='btn btn-info' href='#'>
                    <i class='icon-edit'></i>
                  </a>
                  <a ng-class="{true: 'btn-success', false:'btn-danger'} [poll.state==='active']" class='btn' titlePoll="{{poll.title}}" statePoll="{{poll.state}}" idPoll="{{poll._id}}" onclick="changeState(this)">
                    <span>{{poll.state}}</span>
                  </a>
				  
                </td>
				</tr>
            </tbody>
          </table>
         </div>
      </div>
   </div>
   <!--<br><hr><br>
   <pre>{{ polls | json}}</pre>-->
   
   <script>
   
		function changeState(elem) {
			var id = $(elem).attr('idPoll');
			var state = $(elem).attr('statePoll');
			var title = $(elem).attr('titlePoll');
			var newState = (state == "active" ? "closed" : "active");
			var kid = $(elem).children();
			
			$.ajax({
				type: "PUT",
				url: "/api/polls/"+id,
				data: {title: title, state: newState}
			});
			
			kid.html(newState);
			
			if(newState == "active") {
				$(elem).attr('statePoll', newState);
				$(elem).removeClass("btn-danger");				
				$(elem).addClass("btn-success");
			}else {
				$(elem).attr('statePoll', newState);
				$(elem).removeClass("btn-success");				
				$(elem).addClass("btn-danger");
			}
		}
   </script>
</div>